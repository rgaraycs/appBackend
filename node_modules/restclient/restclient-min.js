/**
 * @class RCBase64
 * This class Encode and Decode Base64
 * @singleton
 */
var RCBase64={keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="",n,r,i,s,o,u,a,f=0;e=this.utf8_encode(e);while(f<e.length)n=e.charCodeAt(f++),r=e.charCodeAt(f++),i=e.charCodeAt(f++),s=n>>2,o=(n&3)<<4|r>>4,u=(r&15)<<2|i>>6,a=i&63,isNaN(r)?u=a=64:isNaN(i)&&(a=64),t=t+this.keyStr.charAt(s)+this.keyStr.charAt(o)+this.keyStr.charAt(u)+this.keyStr.charAt(a);return t},decode:function(e){var t="",n,r,i,s,o,u,a,f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length)s=this.keyStr.indexOf(e.charAt(f++)),o=this.keyStr.indexOf(e.charAt(f++)),u=this.keyStr.indexOf(e.charAt(f++)),a=this.keyStr.indexOf(e.charAt(f++)),n=s<<2|o>>4,r=(o&15)<<4|u>>2,i=(u&3)<<6|a,t+=String.fromCharCode(n),u!==64&&(t+=String.fromCharCode(r)),a!==64&&(t+=String.fromCharCode(i));return t=this.utf8_decode(t),t},utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="",n,r;for(n=0;n<e.length;n++)r=e.charCodeAt(n),r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128));return t},utf8_decode:function(e){var t="",n=0,r=0,i=0,s=0;while(n<e.length)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(i=e.charCodeAt(n+1),t+=String.fromCharCode((r&31)<<6|i&63),n+=2):(i=e.charCodeAt(n+1),s=e.charCodeAt(n+2),t+=String.fromCharCode((r&15)<<12|(i&63)<<6|s&63),n+=3);return t}},RestClient;RestClient=function(){return this.VERSION="0.1.2",this.authorization={},this.server={},this.response={},this.headers={},this.needsAuthorization=!0,this.authorizationType="none",this.accessToken={},this.RESTMethods={create:"POST",read:"GET",update:"PUT","delete":"DELETE"},this.OAUTH2GrantTypes={code:"authorization_code",implicit:"token",user:"password",client:"client_credentials",refresh:"refresh_token"},this},RestClient.prototype.reset=function(){return this.authorization={},this.server={},this.response={},this.headers={},this.needsAuthorization=!0,this.authorizationType="none",this},RestClient.prototype.setClient=function(e,t,n){return this.authorization.client_id=e,this.authorization.client_secret=t,this.authorization.client_url=n!=="undefined"?n:null,this},RestClient.prototype.setGrantType=function(e,t){return this.authorization.grant_type=this.OAUTH2GrantTypes[e]!=="undefined"?this.OAUTH2GrantTypes[e]:null,this.authorization=_.extend(this.authorization,t),this},RestClient.prototype.setAuthorizationServer=function(e){var t=!0,n;return typeof e=="undefined"||e===null?t=!1:(n=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,e.match(n)?this.server.rest_auth_uri=e:t=!1),t},RestClient.prototype.toParams=function(e){var t=_.keys(e),n=[];return _.each(t,function(t){n.push(t+"="+e[t])}),n.join("&")},RestClient.prototype.createXHR=function(){var e;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("MSXML2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}return e?e:!1},RestClient.prototype.authorize=function(e){var t=this,n=!1,r="create",i=this.RESTMethods[r],s,o,u;s=RCBase64.encode(this.authorization.client_id+":"+this.authorization.client_secret),o=this.createXHR();try{o.open(i,this.server.rest_auth_uri,!1)}catch(a){return XHRFailure(a,{}),n}o.onreadystatechange=function(){e.ready&&e.ready(o);if(o.readyState===4)if(o.status===200){var r=JSON.parse(o.responseText);t.accessToken=r.token?r.token:{},n=!0,e.success&&e.success(o)}else e.failure&&e.failure(o)},u={};if(this.authorization.grant_type){u.grant_type=this.authorization.grant_type;switch(this.authorization.grant_type){case"authorization_code":u.code=this.authorization.code;break;case"token":u.token=this.authorization.token;break;case"password":u.username=this.authorization.username,u.password=this.authorization.password;break;case"client_credentials":u.client_id=this.authorization.client_id,u.client_id=this.authorization.client_secret;break;case"refresh_token":u.refresh_token=this.authorization.refresh_token}}return this.needsAuthorization&&o.setRequestHeader("Authorization","Basic "+s),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),_.each(this.headers,function(e,t){o.setRequestHeader(t,e)}),o.send(this.toParams(u)),n},RestClient.prototype.setHeader=function(e,t){var n=!0,r;return e&&t?(r=JSON.parse('{"'+e+'" :  "'+t+'"}'),this.headers=_.extend(this.headers,r)):n=!1,n},RestClient.prototype.setAuthorizationMode=function(e){return _.isBoolean(e)&&(this.needsAuthorization=e),this},RestClient.prototype.getVersion=function(){return this.VERSION},RestClient.prototype.setAuthorizationType=function(e){var t={none:1,basic:1,oauth2:1},n=!1;return t[e]&&(this.authorizationType=e,n=!0),n},RestClient.prototype.setBasicCredentials=function(e,t){return this.authorization.basic_user=e,this.authorization.basic_password=t,this},RestClient.prototype.setAccessToken=function(e){return typeof e=="object"&&(this.accessToken=e),this},RestClient.prototype.getCall=function(e,t,n){return typeof n=="undefined"&&(n=null),this.consume("read",e,t,n)},RestClient.prototype.postCall=function(e,t){return this.consume("create",e,t,null)},RestClient.prototype.putCall=function(e,t,n){return this.consume("update",e,n,t)},RestClient.prototype.deleteCall=function(e,t,n){return this.consume("delete",e,n,t)},RestClient.prototype.consume=function(e,t,n,r){var i,s,o,u={},a=null,f,l,c,h=!0;switch(e){case"read":f=t,r&&(f+=r),f+="?access_token="+this.accessToken.access_token,n!=={}&&(f+="&"+this.toParams(n)),h=!1;break;case"create":f=t;break;case"update":f=t+r;break;case"delete":f=t+r}s=this.createXHR();switch(this.authorizationType){case"none":break;case"basic":i=RCBase64.encode(this.authorization.basic_user+":"+this.authorization.basic_user),s.setRequestHeader("Authorization","Basic "+i);break;case"oauth2":if(!this.accessToken.access_token)return c={success:!1,msg:"Access Token not defined"},this.RequestFailure(c),JSON.stringify(c)}o=this.RESTMethods[e];try{s.open(o,f,!1)}catch(p){return XHRFailure(p,n),!1}return l=this,s.onreadystatechange=function(){s.readyState===4&&(s.status===200?(s.responseText!==""?u=JSON.parse(s.responseText):u=s.responseText,l.RestSuccess(o,u)):(s.responseText!==""?u=JSON.parse(s.responseText):u=s.responseText,l.RestFailure(o,u)))},s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),_.each(this.headers,function(e,t){s.setRequestHeader(t,e)}),h&&(a="access_token="+this.accessToken.access_token+"&json="+JSON.stringify(n)),s.send(a),u},RestClient.prototype.RestSuccess=function(e,t){},RestClient.prototype.RestFailure=function(e,t){},RestClient.prototype.RequestFailure=function(e){},RestClient.prototype.XHRFailure=function(e,t){};if(typeof exports!="undefined"){module.exports=RestClient;var _=require("underscore")};